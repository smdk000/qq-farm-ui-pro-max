# CONSENSUS: 蹲守偷菜功能

## 1. 业务需求
增加“蹲守偷菜”功能，解决普通定时巡查偷菜存在的“时延过长容易被别人先偷”的问题。
核心逻辑：大循环扫田时，遇到未成熟的果实，计算还剩下多少秒成熟，预埋一个单独的 Timer，成熟前踩点，成熟后加一个随机或设定的延迟时间进行偷取。

## 2. 功能配置项
需要在 `StealSettings.vue` 界面补充两个配置项：
- `stakeoutEnabled` (boolean)：是否开启蹲守偷菜模式，默认 false。
- `stakeoutDelaySec` (number)：从作物成熟开始算起，延迟多少秒进行偷取，避免被系统或玩家举报为零秒秒偷。建议最小值为 1 秒，最大值不限，建议默认给个 3-5 秒。

相应的，后端需要在 `models/store.js` 里持久化这个配置到 `automation` 节点中。

## 3. 约束与安全边界
1. **防止风暴**：为避免同时有过多任务启动导致请求风暴被踢，如果是很多地块在极近时间成熟，只进入好友农场一次，一次全部收获完毕。
2. **过滤名单优先**：蹲守同样适用黑白名单，如果作物在黑名单中，就不要生成蹲守 Task。
3. **好友白名单优先**：如果不偷某好友，那他家也不应该发起蹲守。
4. **自动失效与刷新**：如果在等待时间段内，重新发起了一次巡查，如果该作物状态变化（比如被别人偷过了或者被施肥了），则会覆盖原有计时器或刷新它，依赖现有 `setTimeoutTask` 的 Key 覆盖机制实现防误偷。

## 4. 验收标准
1. 在“设置” - “偷菜设置”中成功看到新开关和延迟时间的输入框，并在后端成功保存/获取。
2. 日志能看到类似于 `[蹲守] 发现 xxx 的 萝卜 还有 120秒成熟，已加入蹲守雷达` 的提示。
3. 在即将成熟的三秒时，能够进入好友农场踩点等待，等待时间到达（成熟时间 + 设定 delay 秒数），执行精确收取，并日志输出。
4. 如果配置项不开启，则不触发此逻辑。
