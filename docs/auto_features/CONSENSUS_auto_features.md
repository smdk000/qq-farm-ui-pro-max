# CONSENSUS: 自动同意好友与60秒施肥（防偷）功能

## 1. 确立共识

基于 `ALIGNMENT_auto_features.md` 的分析，我们明确以下事实并得出开发共识：

1. **现有能力：** 当前前端和后端的业务执行逻辑**不具备**“自动通过好友”与“60秒施肥防偷”这两个功能。不过，底层的好友协议已被逆向并封装成函数，具备了实现基础。
2. **开发目标：** 补充前端 UI 独立开关，打通并实现对应的后端轮询/调度自动化防偷与扩列逻辑。
3. **技术路线：**
   - **前端：** 以 Vue3 组合式 API + `BaseSwitch` 继续在 `Settings.vue` 内部扩展，绑定新的字段。
   - **后端通信：** 在现有的 `setInterval` 和 `setTimeout` 调度器体系下（即 `farmScheduler` 与 `friendScheduler`）无缝注册新的钩子或独立任务。

## 2. 验收标准 (Acceptance Criteria)

### 2.1 自动通过好友 (User Story 1)
- **UI:** 管理面板的「自动控制 -> 农场基础操作（或社交互动详细策略）」中包含 "自动同意好友" 的开关，并能正常保存至后端。
- **Logic:** 开启后，系统能够定期（例如随巡查好友的节奏，或独立的循环）调用 `getApplications` 接口获取所有好友申请者，并调用 `acceptFriends` 批量全部同意。
- **Log:** 当检测到并同意了新好友时，前端日志控制台能看到类似：“[好友] 自动同意了 X 位新玩家的好友申请”。

### 2.2 60秒施肥防偷 (User Story 2)
- **UI:** 管理面板的「自动控制 -> 化肥与精细控制」新增 "60秒施肥(防偷)" 的开关，正常生效同步至后端。
- **Logic:**
  - 开启该选项后，不管土地上当前还剩多久，当时间来到距离成熟 **大约60-70秒** 的区间时。
  - 程序主动给这块地施一次肥（一般为普通化肥），使成熟时间瞬间归零。
  - 程序判断施肥成功后，不再等待下次大循环，紧接着同步或立刻发送 `harvest` 收获该土地果实。
- **Log:** 控制台会打印：“[防偷行动] 土地#ID 进入60秒防偷保护，已自动施肥并瞬间抢收！”
- **Error Handling:** 若仓库里已无肥料导致施肥失败，必须能在 60 秒后恢复普通的自动收获动作而不应当死锁。

## 3. 实现边界
- 不引入新的定时器库，复用项目自带的 `createScheduler` 对象进行任务编排。
- 防偷判定不干扰原本的种植和除草/除虫，相互正交。
- 这些功能属于增强版的外置功能，仅在配置文件明确 `true` 时触发。

---
*进入下一步：制定 DESIGN 与 Plan (产出 HTML)*
