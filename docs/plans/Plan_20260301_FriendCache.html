<!-- PLAN -->
<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥½å‹å¤´åƒåŠç¼“å­˜ä¼˜åŒ–è®¡åˆ’</title>
    <style>
        :root {
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --accent: #3b82f6;
            --success: #22c55e;
            --border: #334155;
        }

        body {
            font-family: system-ui, -apple-system, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 2rem;
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            color: var(--accent);
            border-bottom: 2px solid var(--border);
            padding-bottom: 0.5rem;
        }

        h2 {
            color: #818cf8;
            margin-top: 2rem;
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        code {
            background: #000;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: monospace;
            color: #fbbf24;
        }

        .highlight {
            color: var(--success);
            font-weight: bold;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
    </style>
</head>

<body>

    <h1>ğŸŒ± å¥½å‹å¤´åƒåŠæ•°æ®åº“ç¼“å­˜ä¼˜åŒ–è®¡åˆ’</h1>
    <p>é’ˆå¯¹â€œå·èœè®¾ç½®â€ä¸­å¤´åƒä¸æ˜¾ç¤ºä»¥åŠå‰ç«¯é¢‘ç¹æ‹‰å–å¥½å‹åˆ—è¡¨å¯èƒ½ç»™æœåŠ¡å™¨äº§ç”Ÿå‹åŠ›çš„ç—›ç‚¹ï¼Œåˆ¶å®šä»¥ä¸‹æ·±å±‚ä¿®å¤ä¸ä¼˜åŒ–è®¡åˆ’ã€‚</p>

    <div class="card">
        <h2>1. UI é—®é¢˜ä¿®å¤ (StealSettings.vue)</h2>
        <p>ç›®å‰ <code>StealSettings.vue</code> ä½¿ç”¨çš„ <code>qlogo3.store.qq.com</code> æ¥å£å­˜åœ¨è¾ƒé«˜çš„æ— æ•ˆåŠ è½½ç‡ã€‚æˆ‘ä»¬å°†ï¼š</p>
        <ul>
            <li>å¼•å…¥ä¸ <code>Friends.vue</code> å®Œå…¨ä¸€è‡´çš„é«˜å¯ç”¨ <code>getFriendAvatar</code> å‡½æ•°æœºåˆ¶ã€‚</li>
            <li>å¦‚æœåŸç”Ÿé“¾æ¥æˆ– <code>qlogo3</code> å¤±è´¥ï¼Œå¿«é€Ÿæ— æ„Ÿé™çº§åˆ° <code>https://q1.qlogo.cn/g?b=qq&nk=${uin}&s=100</code>ã€‚</li>
            <li>åŒ¹é…å…¨å±€ç»Ÿä¸€æ ·å¼çš„ <code>i-carbon-user</code> å›¾ç‰‡åŠ è½½å¤±è´¥å ä½ç¬¦ã€‚</li>
        </ul>
    </div>

    <div class="card">
        <h2>2. åç«¯ SQLite é«˜æ•ˆç¼“å­˜å»ºè®¾</h2>
        <p>å‰ç«¯ <code>Friends.vue</code> å’Œ <code>StealSettings.vue</code> æ‰“å¼€æ—¶ä¼šé«˜é¢‘è¯·æ±‚
            <code>/api/friends</code>ï¼Œå¯¼è‡´åº•å±‚ä¸æ–­ç»™è…¾è®¯æœåŠ¡å™¨å‘é€ <code>GetAllFriends</code> åè®®ã€‚ä¸ºäº†å¤§å¹…åº¦é™ä½é£æ§å‹åŠ›ä¸æ— ç”¨è¯·æ±‚ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€å±‚ DB ç¼“å­˜æ¶æ„ï¼š</p>

        <ol>
            <li><strong>åˆ›å»ºæ•°æ®è¡¨</strong>ï¼šåœ¨ <code>migrations</code> ç›®å½•ä¸‹æ–°å¢ <code>003-friends_cache.sql</code>ã€‚å»ºç«‹
                <code>account_friends_cache</code> è¡¨ï¼Œå­˜å‚¨ <code>account_id</code>, <code>friend_gid</code>,
                <code>friend_uin</code>, <code>name</code>, <code>avatar_url</code> ç­‰ä¿¡æ¯ã€‚</li>
            <li><strong>æ™ºèƒ½å†™å…¥ç¼“å­˜ (Upsert)</strong>ï¼šç³»ç»Ÿå†…éƒ¨çš„è‡ªåŠ¨è½®è¯¢ä»»åŠ¡ï¼ˆWorkerï¼‰å¤©ç„¶ä¼šåœ¨åå°å‘¨æœŸæ€§è¿ä½œã€‚æ¯æ¬¡åå°è‡ªåŠ¨åˆ·æ–°å®Œæœ€æ–°çš„å¥½å‹åˆ—è¡¨åï¼Œå¼•æ“å°†ä¼š**é™é»˜åŒæ­¥/æ›´æ–°**è‡³æœ¬åœ°
                SQLiteï¼Œä¸€å¤©åªé«˜é¢‘æ“ä½œä¸€æ¬¡ï¼Œç¼“è§£æ•°æ®åº“å‹åŠ›ã€‚</li>
            <li><strong>æ¯æ—¥è‡ªç„¶æ—¥åŒæ­¥çº¦æŸ</strong>ï¼šé’ˆå¯¹ <code>StealSettings.vue</code>
                è¿™ä¸ªåªéœ€è¦ç”¨æ¥ç­›é€‰å¥½å‹çš„çº¯é…ç½®é¡µé¢ï¼Œå°†ä¸å†è§¦å‘å¯¹è…¾è®¯æœåŠ¡å™¨çš„å®æ—¶æ‹‰å–ï¼Œè€Œæ˜¯<strong>ç›´æ¥è°ƒç”¨æ–°å¢çš„æ¥å£ä» SQLite è¯»å–ç¼“å­˜çš„å¥½å‹æ¸…å•</strong>ï¼ˆæé€Ÿå“åº”/å®Œå…¨æ— é£æ§é£é™©ï¼‰ã€‚å¯¹äºä¸»è§†å›¾
                <code>Friends.vue</code> åˆ™ä¾ç„¶ç»´æŒåŸçŠ¶ï¼Œä»¥ä¾¿å±•ç¤ºä½œç‰©çš„å®æ—¶çŠ¶æ€ï¼ˆå·ã€è™«ã€è‰ç­‰ï¼‰ã€‚</li>
        </ol>
    </div>

    <div class="card">
        <h2>3. å½±å“é¢åˆ†æ (Impact Analysis)</h2>
        <p><strong>ä¿®æ”¹æ¨¡å—</strong>ï¼š</p>
        <ul>
            <li><code>web/src/views/StealSettings.vue</code>: ä¿®æ”¹ UI å¤´åƒç»‘å®šé€»è¾‘ã€‚</li>
            <li><code>core/src/database/migrations/003-friends_cache.sql</code>: æ–°å¢è¡¨ç»“æ„ã€‚</li>
            <li><code>core/src/services/friend.js</code>: æ”¹é€  <code>getFriendsList</code> æ–¹æ³•ï¼Œè¿½åŠ  SQLite æ•°æ®åº“ upsert é€»è¾‘ï¼›å¼€æ”¾
                <code>getCachedFriendsList</code> ä¸“ä¾›è®¾ç½®é¡µæ‹¿å–æœ¬åœ°åå•ã€‚</li>
            <li><code>core/src/controllers/admin.js</code>: æ–°å¢ <code>GET /api/friends/cache</code> æä¾›ç»™è®¾ç½®é¡µè°ƒç”¨ã€‚</li>
        </ul>
    </div>

</body>

</html>