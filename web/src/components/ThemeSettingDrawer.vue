/* eslint-disable no-alert, unused-imports/no-unused-vars */

<script setup lang="ts">
import BaseSwitch from '@/components/ui/BaseSwitch.vue'
import { useAppStore } from '@/stores/app'

defineProps<{
  show: boolean
}>()

const emit = defineEmits<{
  (e: 'close'): void
}>()

const appStore = useAppStore()

// äº”å¤§é¢„è®¾ç³»ç»Ÿä¸»é¢˜è‰²
const THEME_OPTIONS = [
  { key: 'default', color: '#22c55e', bg: 'bg-green-500', bgDark: 'bg-green-600', shadow: 'shadow-[0_0_8px_rgba(34,197,94,0.6)]', name: 'å¾¡å†œç¿ ç»¿ (é»˜è®¤)', desc: 'ç»å…¸æŠ¤çœ¼é…è‰²ï¼Œç”Ÿæœºç›ç„¶ã€‚ä»£è¡¨å†œä¸šçš„ä¸°æ”¶ä¸ç¨³å®šã€‚' },
  { key: 'sakura', color: '#ffc0cb', bg: 'bg-[#ffc0cb]', bgDark: 'bg-pink-400', shadow: 'shadow-[0_0_8px_rgba(255,192,203,0.8)]', name: 'æ¨±èŠ±ç²‰é»› (Sakura)', desc: 'æ´»æ³¼çµåŠ¨çš„å°‘å¥³ç²‰ï¼ŒçŒ›ç”·æ ‡é…ï¼Œç‚¹ç¼€æç®€çš„ç«ç‘°è¾¹æ¡†ã€‚' },
  { key: 'cyber', color: '#8b5cf6', bg: 'bg-violet-500', bgDark: 'bg-fuchsia-600', shadow: 'shadow-[0_0_8px_rgba(139,92,246,0.6)]', name: 'å…¨æ¯èµ›åš (Neon)', desc: 'é«˜å¯¹æ¯”åº¦çš„ç”µç«è§å…‰ç´«ï¼Œæ­é…æå¤œèƒŒæ™¯ï¼Œå‡¸æ˜¾æå®¢æ‰§è¡ŒåŠ›ã€‚' },
  { key: 'elegant', color: '#eab308', bg: 'bg-yellow-500', bgDark: 'bg-amber-600', shadow: 'shadow-[0_0_8px_rgba(234,179,8,0.6)]', name: 'å°Šè´µé»¯é‡‘ (Elegant)', desc: 'é«˜ç«¯ä¼˜é›…ï¼Œé»„é»‘ç›¸é—´ã€‚é€‚åˆé•¿æœŸæŒ‚æœºçš„å¤§ä½¬ä½¿ç”¨ã€‚' },
  { key: 'ocean', color: '#0ea5e9', bg: 'bg-sky-500', bgDark: 'bg-cyan-600', shadow: 'shadow-[0_0_8px_rgba(14,165,233,0.6)]', name: 'æ·±æµ·çŸ©é˜µ (Ocean)', desc: 'å†·é™ã€ç†æ™ºçš„æ•°æ®åŒ–æµ…è“è‰²è°ƒï¼Œå¸¦æ¥æµç•…çš„æ•°æ®ç›‘æ§ä½“éªŒã€‚' },
]
function changeTheme(themeKey: string) {
  appStore.setUIConfig({ colorTheme: themeKey })
}
</script>

<template>
  <div v-if="show" class="fixed inset-0 z-50 overflow-hidden" @click="emit('close')">
    <!-- é®ç½©å±‚ -->
    <div
      class="absolute inset-0 bg-black/20 backdrop-blur-sm transition-opacity dark:bg-black/40"
    />

    <!-- å³ä¾§æŠ½å±‰ä¸»ä½“ -->
    <div
      class="glass-panel absolute bottom-0 right-0 top-0 w-[300px] flex flex-col transform border-l border-white/20 shadow-2xl transition-transform duration-300 dark:border-white/10"
      @click.stop
    >
      <!-- å¤´éƒ¨ -->
      <div class="flex items-center justify-between border-b border-gray-200/50 px-5 py-4 dark:border-white/10">
        <h2 class="glass-text-main flex items-center gap-2 text-base font-medium">
          <div class="i-carbon-settings text-lg text-primary" />é¡¹ç›®é…ç½®
        </h2>
        <button
          class="rounded-md p-1.5 text-gray-400 transition-colors hover:bg-gray-100 hover:text-gray-600 dark:hover:bg-gray-700 dark:hover:text-gray-300"
          @click="emit('close')"
        >
          <div class="i-carbon-close text-lg" />
        </button>
      </div>

      <!-- æœ¬ä½“æ»šåŠ¨åŒºåŸŸ -->
      <div class="custom-scrollbar flex-1 overflow-y-auto px-6 py-6 space-y-8">
        <!-- å¤´éƒ¨é…ç½®åŒºï¼šç‰ˆæƒä¿¡æ¯ & æ·±è‰²æ¨¡å¼ -->
        <div class="group relative flex items-center justify-between overflow-hidden border border-white/20 rounded-xl bg-black/5 p-4 shadow-sm backdrop-blur-sm dark:border-white/10 dark:bg-black/20">
          <!-- è£…é¥°æ€§å…‰æ™• -->
          <div class="pointer-events-none absolute h-20 w-20 rounded-full bg-primary/10 blur-xl transition-colors -right-4 -top-4 group-hover:bg-primary/20" />

          <div class="glass-text-muted relative z-10 text-xs font-medium tracking-tight font-mono space-y-2">
            <div class="flex items-center gap-2">
              <div class="i-carbon-code text-sm text-primary" /><span>Maker: smdk000</span>
            </div>
            <div class="flex items-center gap-2">
              <div class="i-carbon-logo-qq text-sm text-primary" /><span>Qç¾¤: 227916149</span>
            </div>
          </div>

          <!-- ç¯å¢ƒæ¨¡å¼åˆ‡æ¢ -->
          <div class="relative z-10 flex flex-col items-end gap-2 border-l border-white/20 pl-4 dark:border-white/10">
            <span class="glass-text-main text-[11px] font-bold tracking-wider transition-colors duration-300">
              {{ appStore.themeMode === 'auto' ? 'è‡ªåŠ¨è·Ÿéš' : (appStore.isDark ? 'æ·±è‰²æ¨¡å¼' : 'æµ…è‰²æ¨¡å¼') }}
            </span>
            <div
              class="relative h-6 w-16 inline-flex items-center border border-white/20 rounded-full bg-white/50 p-1 shadow-inner transition-colors duration-300 ease-in-out dark:border-white/10 dark:bg-black/40"
            >
              <div class="relative z-10 h-full w-full flex items-center justify-between">
                <div title="æµ…è‰²æ¨¡å¼" class="h-full flex flex-1 cursor-pointer items-center justify-center text-[10px] transition-opacity" :class="appStore.themeMode === 'light' ? 'opacity-100 grayscale-0' : 'opacity-40 grayscale hover:opacity-80'" @click="appStore.setUIConfig({ theme: 'light' })">
                  â˜€ï¸
                </div>
                <div title="è‡ªåŠ¨è·Ÿéš" class="h-full flex flex-1 cursor-pointer items-center justify-center text-[10px] transition-opacity" :class="appStore.themeMode === 'auto' ? 'opacity-100 grayscale-0' : 'opacity-40 grayscale hover:opacity-80'" @click="appStore.setUIConfig({ theme: 'auto' })">
                  A
                </div>
                <div title="æ·±è‰²æ¨¡å¼" class="h-full flex flex-1 cursor-pointer items-center justify-center text-[10px] transition-opacity" :class="appStore.themeMode === 'dark' ? 'opacity-100 grayscale-0' : 'opacity-40 grayscale hover:opacity-80'" @click="appStore.setUIConfig({ theme: 'dark' })">
                  ğŸŒ™
                </div>
              </div>
              <!-- æ»‘å— -->
              <div
                class="pointer-events-none absolute top-1 h-4 w-4 rounded-full bg-white shadow-md transition-all duration-300 ease-in-out dark:bg-gray-300"
                :class="{
                  'left-1': appStore.themeMode === 'light',
                  'left-[calc(50%-8px)]': appStore.themeMode === 'auto',
                  'left-[calc(100%-20px)]': appStore.themeMode === 'dark',
                }"
              />
            </div>
          </div>
        </div>

        <!-- æ€§èƒ½é™çº§æ¨¡å¼ -->
        <div class="group flex items-center justify-between border border-white/20 rounded-xl bg-white/20 p-4 shadow-sm backdrop-blur-sm transition-all duration-300 dark:border-white/10 dark:bg-black/10 hover:bg-white/30 dark:hover:bg-black/20">
          <div class="flex flex-col gap-1 pr-4">
            <div class="glass-text-main flex items-center gap-2 text-[13px] font-bold">
              <div class="i-carbon-flash text-base text-primary" />æç®€æ€§èƒ½æ¨¡å¼
            </div>
            <div class="glass-text-muted text-[11px] leading-tight">
              å…³é—­å…¨ç«™æ¯›ç»ç’ƒç‰¹æ•ˆï¼Œè§£å†³ä½é…ç”µè„‘æ ¸æ˜¾æ¸²æŸ“ç¼“æ…¢ä¸æ»‘åŠ¨å¡é¡¿é—®é¢˜ã€‚
            </div>
          </div>
          <BaseSwitch :model-value="appStore.performanceMode ?? false" @update:model-value="appStore.setUIConfig({ performanceMode: $event ?? false })" />
        </div>

        <!-- ç³»ç»Ÿä¸»é¢˜å¤§å¡ç‰‡å˜ä½“ -->
        <div>
          <h3 class="glass-text-muted relative z-10 mx-auto mb-4 w-max rounded-lg bg-transparent px-2 text-center text-[13px] font-medium backdrop-blur-md -mt-5">
            ç³»ç»Ÿä¸»é¢˜ (é¢„è®¾å˜ä½“)
          </h3>
          <div class="grid grid-cols-1 gap-4">
            <template v-for="t in THEME_OPTIONS" :key="t.key">
              <div
                class="group relative cursor-pointer overflow-hidden border rounded-xl p-4 shadow-sm transition-all duration-300"
                :class="appStore.colorTheme === t.key ? 'dark:bg-black/20 bg-white/50 backdrop-blur-sm' : 'border-white/20 dark:border-white/10 bg-white/20 dark:bg-black/10 hover:scale-[1.02] backdrop-blur-sm'"
                :style="appStore.colorTheme === t.key ? `border-color: ${t.color}; box-shadow: 0 0 0 1px ${t.color}20, 0 4px 12px -2px ${t.color}20;` : ''"
                @click="changeTheme(t.key)"
              >
                <!-- ä»…é€‰ä¸­çš„æ‹¥æœ‰å¾®å¼±èƒŒæ™¯å…‰æ™• -->
                <div v-show="appStore.colorTheme === t.key" class="pointer-events-none absolute inset-0 opacity-5" :style="`background-color: ${t.color}`" />
                <!-- é¼ æ ‡æ‚¬åœåŠé€æ˜æ¸å˜ç‰¹æ•ˆ -->
                <div class="pointer-events-none absolute inset-0 opacity-0 transition-opacity group-hover:opacity-10" :style="`background: linear-gradient(to bottom right, ${t.color}, transparent);`" />

                <div class="relative z-10 mb-3 flex items-center justify-between">
                  <div class="glass-text-main flex items-center gap-2 text-[15px] font-bold">
                    <span class="h-3.5 w-3.5 rounded-full" :class="[t.bg, t.shadow]" />
                    {{ t.name }}
                  </div>
                  <!-- é€‰ä¸­æ ‡è¯† -->
                  <div v-if="appStore.colorTheme === t.key" class="flex items-center justify-center rounded px-1.5 py-0.5 text-xs text-white shadow-sm" :style="`background-color: ${t.color}`">
                    <div class="i-carbon-checkmark" />
                  </div>
                </div>
                <!-- æè¿° -->
                <div class="glass-text-muted mb-4 pr-2 text-xs leading-relaxed">
                  {{ t.desc }}
                </div>
                <!-- åº•å±‚é¢œè‰²ç¤ºä¾‹æ–¹å— -->
                <div class="relative z-10 flex gap-2">
                  <div class="h-6 w-6 rounded" :class="t.bg" />
                  <div class="h-6 w-6 rounded" :class="t.bgDark" />
                  <div class="glass-panel h-6 w-6 border rounded" />
                </div>
              </div>
            </template>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<style scoped>
.custom-scrollbar::-webkit-scrollbar {
  width: 6px;
}
.custom-scrollbar::-webkit-scrollbar-track {
  background: transparent;
}
.custom-scrollbar::-webkit-scrollbar-thumb {
  background-color: rgba(156, 163, 175, 0.3);
  border-radius: 4px;
}
.custom-scrollbar:hover::-webkit-scrollbar-thumb {
  background-color: rgba(156, 163, 175, 0.5);
}
</style>
